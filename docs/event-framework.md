# Event Framework Overview

## 1. Фракции и их мотивация

| Фракция | Основная цель | Ключевые триггеры вмешательства |
| --- | --- | --- |
| Корона / центральная власть | Укрепление стабильности и расширение влияния | Спад лояльности регионов, рост влияния соперников, угрозы внешней безопасности |
| Дворянские дома | Увеличение привилегий, земель и политического веса | Изменения налоговой политики, перераспределение земель, снижение престижа | 
| Гильдии купцов | Защита торговых путей и рост прибыли | Торговые ограничения, повышение пошлин, блокада ресурсов |
| Ремесленные цеха | Поддержание спроса и условий труда | Импорт дешёвых товаров, снижение заказов, рост безработицы |
| Духовенство | Сохранение влияния на население и моральный порядок | Ереси, рост преступности, нарушение церковных традиций |
| Военное сословие / гарнизоны | Поддержание финансирования и дисциплины | Сокращение бюджета, поражения в боях, бунты |
| Крестьянство / горожане | Улучшение качества жизни и снижение налогов | Засухи, болезни, непомерные налоги, реквизиции |
| Тайная канцелярия / шпионы | Сбор информации и устранение угроз | Утечка секретов, заговоры, активность иностранных агентов |

## 2. Шаблоны событий

| Категория | Описание шаблона | Примеры вариаций |
| --- | --- | --- |
| Экономический кризис | Резкое ухудшение финансовых показателей или ресурсной базы | Обвал цен на сырьё, банкротство гильдии, потеря торгового маршрута |
| Стихийное бедствие | Природные явления с разрушительными последствиями | Засуха, наводнение, землетрясение, эпидемия |
| Политические интриги | Внутренние конфликты за власть и влияние | Заговор дворян, саботаж чиновников, скандал с наследником |
| Социальные потрясения | Массовое недовольство, протесты, бунты | Крестьянское восстание, городские протесты, религиозный раскол |
| Военные угрозы | Внешние или внутренние вооружённые конфликты | Вторжение соседей, мятеж гарнизона, пиратские набеги |
| Технологические / магические открытия | Новшества, способные изменить баланс сил | Новое оружие, алхимическое открытие, запрещённые ритуалы |
| Дипломатические кризисы | Обострение отношений с внешними силами | Требование союзников, нарушение договора, шантаж соседей |

## 3. Параметры процедурной генерации

| Параметр | Назначение | Возможные значения |
| --- | --- | --- |
| Условия появления | Контекстные факторы, необходимые для активации события | Пороговые значения ресурсов, уровень стабильности, наличие активной фракции |
| Источник события | Фракция или внешняя сила, инициирующая событие | Любая зарегистрированная фракция, случайное природное явление |
| Масштаб | Определяет охват и серьёзность | Локальный, региональный, имперский |
| Срочность | Влияет на дедлайны решений и штрафы | Низкая, средняя, высокая |
| Варианты решений | Доступные игроку реакции | 2-4 уникальных пути, включая игнорирование |
| Стоимость решений | Ресурсы, требуемые для выбранного варианта | Золото, влияние, людские ресурсы, репутация |
| Последствия | Изменения в состоянии мира после выбора | Модификаторы ресурсов, отношение фракций, разблокировка новых событий |
| Вероятность эскалации | Шанс перехода в более тяжёлую фазу | 0-100%, модифицируется действиями игрока |
| Связанные события | Цепочки или зависимости | Список идентификаторов событий, которые активируются или блокируются |

## 4. Структура данных события

```json
{
  "id": "string",                // Уникальный идентификатор события
  "title": "string",             // Название события
  "category": "enum",            // Категория из раздела 2
  "factions": ["string"],        // Фракции, вовлечённые в событие
  "conditions": {
    "metrics": {                  // Пороговые показатели
      "loyalty": "operator value",
      "treasury": "operator value"
    },
    "flags": ["string"]          // Состояния, которые должны быть активны
  },
  "triggers": ["string"],        // Конкретные активаторы (например, завершение миссии)
  "options": [
    {
      "id": "string",
      "description": "string",
      "cost": {
        "gold": "number",
        "influence": "number",
        "manpower": "number"
      },
      "effects": [
        {
          "type": "enum",        // Изменяемый параметр (ресурсы, отношение, статус)
          "target": "string",
          "value": "number",
          "duration": "number"   // Для временных эффектов
        }
      ],
      "followUps": ["string"],    // События, открывающиеся после выбора
      "cooldown": "number"       // Ходы до повторного появления
    }
  ],
  "failure": {
    "timeout": "number",         // Ходы до автоприменения последствий
    "effects": ["effectObject"]  // Негативные исходы при бездействии
  }
}
```

## 5. Пауза и вмешательство

- **Карточка события в режиме паузы**: отображает источник, описание и время до провала, подсвечивает текущие угрозы и вовлечённые фракции.
- **Режимы реакции**:
  - *Игрок решает* — пользователь выбирает опцию, добавляет заметку; результат фиксируется в отчёте и системе сохранений.
  - *Советник решает* — показывается прогноз совета (ожидаемая опция и комментарий), после подтверждения применяется стратегия совета.
- **Опции и последствия**: каждая альтернатива содержит стоимость, эффекты, потенциальные follow-up события и отметки «выбрано игроком» / «прогноз совета».
- **Журнал вмешательств**: агрегирует выборы с режимом, заметками и ссылками на прогноз, что позволяет отслеживать эффективность решений во времени.

## 6. Заготовка для наполнения контентом

| ID события | Название | Категория | Источник / Фракция | Краткое описание | Условия появления | Варианты решений | Ключевые последствия | Связанные события |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| `region.infrastructure.milestone` | «Инфраструктура региона достигает нового рубежа» | Технологические / магические открытия | Корона, гильдии купцов | Регион достигает инфраструктурного прорыва | Порог инфраструктуры региона + флаг `infrastructure_milestone` | Увеличить финансирование или перераспределить бюджет | Рост инфраструктуры, подготовка к проверке или застою | follow-up → `region.infrastructure.audit`, `region.infrastructure.stagnation`; эскалация → `region.infrastructure.overextension` |
| `region.infrastructure.audit` | «Аудит инфраструктурных проектов» | Технологические / магические открытия | Корона, гильдии | Проверка эффективности вложений | Инфраструктура ≥ 60 | Усилить надзор или перераспределить средства | Доп. стабильность, риск падения лояльности | follow-up → `region.infrastructure.stagnation` |
| `region.infrastructure.stagnation` | «Темпы строительства замирают» | Экономический кризис | Гильдии, региональные элиты | Проекты простаивают из-за дефицитов | Инфраструктура ≤ 55 | Реинвестировать или законсервировать стройки | Временный прирост инфраструктуры или экономия с риском | follow-up → `region.infrastructure.overextension`; эскалация → `region.infrastructure.overextension` |
| `region.infrastructure.overextension` | «Перерасход бюджета достигает критической точки» | Экономический кризис | Корона, гильдии | Регион тонет в долгах и незавершённых объектах | Инфраструктура ≤ 50 + флаг `infrastructure_overextension` | Ввести внешнее управление или удвоить инвестиции | Восстановление казны ценой лояльности или дорогой рывок | цепочка завершает инфраструктурную ветку |
| `region.loyalty.decline` | «Лояльность региона падает» | Социальные потрясения | Корона, население | Жители жалуются на притеснения | Лояльность ≤ целевого значения + `loyalty_warning` | Утвердить реформы или ввести гарнизон | Рост лояльности, смена фракционных отношений | follow-up → `region.loyalty.reform_progress`, `region.loyalty.resistance`; эскалация → `region.loyalty.uprising` |
| `region.loyalty.reform_progress` | «Реформы набирают темп» | Социальные потрясения | Корона, реформаторы | Команды реформаторов запускают пилоты | Лояльность ≥ 55 | Финансировать пилоты или развернуть агитацию | Рост лояльности, репутации, риск ответной реакции элит | follow-up ↔ `region.loyalty.resistance` |
| `region.loyalty.resistance` | «Элиты формируют сопротивление» | Социальные потрясения | Корона, региональные элиты | Оппозиция саботирует реформы | Лояльность ≤ 50 | Устранить лидеров или расширить диалог | Контроль элит, возврат к прогрессу | follow-up ↔ `region.loyalty.reform_progress`; эскалация → `region.loyalty.uprising` |
| `region.loyalty.uprising` | «Открытое восстание» | Социальные потрясения | Корона, население, элиты | Протесты переходят в вооружённый конфликт | Лояльность ≤ 40 + `loyalty_uprising` | Переговоры или силовое подавление | Восстановление стабильности или репрессии и издержки | финал ветки лояльности |
| `estate.dissatisfaction` | «Сословие готовит политическое давление» | Политические интриги | Конкретное сословие | Элитная группа требует уступок | Удовлетворённость ≤ порога + `estate_pressure` | Переговоры или жёсткая позиция | Рост удовлетворённости или усиление конфликта | follow-up → `estate.monitoring`, `estate.retaliation`; эскалация → `estate.cabal` |
| `estate.monitoring` | «Создан наблюдательный совет» | Политические интриги | Сословие, корона | Стороны делят контроль реформ | Удовлетворённость ≥ 55 | Расширить полномочия или оставить символическую роль | Стабилизация или раздражение сословия | follow-up → `estate.retaliation` |
| `estate.retaliation` | «Кампания возмездия сословия» | Политические интриги | Сословие, тайная канцелярия | Радикалы саботируют решения совета | Удовлетворённость ≤ 45 | Раскрыть заговор или заключить тайную сделку | Потеря влияния сословия или риск тайного союза | follow-up → `estate.cabal`; эскалация → `estate.cabal` |
| `estate.cabal` | «Подпольный союз выходит из тени» | Политические интриги | Сословие, тайная канцелярия | Заговор сословия с внешними спонсорами | Удовлетворённость ≤ 40 + `estate_cabal` | Разоблачить сеть или предложить амнистию | Стабилизация или потеря репутации | финал ветки сословий |
| `treasury.depletion` | «Казна иссякает» | Экономический кризис | Корона, гильдии | Резервы опускаются до критической отметки | Казна ≤ 120 + `budget_alert` | Жёсткая экономия или срочный займ | Сокращение бюджета, рост долга | follow-up → `treasury.recovery_plan`, `treasury.debt_payments`; эскалация → `treasury.default` |
| `treasury.recovery_plan` | «План восстановления бюджета» | Экономический кризис | Корона, гильдии | Министерства предлагают меры экономии | Казна ≥ 120 | Утвердить план или стимулировать торговлю | Рост казны, временный бонус богатства | продолжение ветки казны |
| `treasury.debt_payments` | «Наступает срок выплат по займам» | Экономический кризис | Гильдии, корона | Пришло время возвращать экстренный кредит | Казна ≤ 150 | Погасить из резервов или затянуть переговоры | Снижение казны, восстановление репутации или риск дефолта | follow-up → `treasury.default` |
| `treasury.default` | «Финансовый дефолт грозит империи» | Экономический кризис | Гильдии, корона, военные | Кредиторы угрожают ультиматумом | Казна ≤ 80 + `treasury_default` | Конфисковать активы или выпустить облигации | Восполнение казны ценой репутации или стабильности | финал ветки казны |

## 7. Примеры заполнения поля `triggers`

| ID шаблона | Пример значения `triggers` |
| --- | --- |
| `region.infrastructure.milestone` | `[
  "metric:regions.<название региона>.infrastructure",
  "flag:infrastructure_milestone"
]` |
| `region.loyalty.decline` | `[
  "metric:regions.<название региона>.loyalty",
  "flag:loyalty_warning"
]` |
| `estate.dissatisfaction` | `[
  "metric:estates.<название сословия>.satisfaction",
  "flag:estate_pressure"
]` |
| `treasury.depletion` | `[
  "metric:treasury",
  "flag:budget_alert"
]` |

